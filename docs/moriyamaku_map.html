<!DOCTYPE HTML>
<html lang="ja">
<title>map</title>

<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
	<meta charset="UTF-8" name="viewport"
		content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<!-- tailwind -->
	<script src="https://cdn.tailwindcss.com"></script>

	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
		integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />
	<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
		integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
	<script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-hash/0.2.1/leaflet-hash.min.js"
		integrity="sha512-0A4MbfuZq5Au9EdpI1S5rUTXlibNBi8CuZ/X3ycwXyZiCjNzpiO9YH6EMqPgzZm6vfNCuZStBQHjnO17nIC0IQ=="
		crossorigin="anonymous" referrerpolicy="no-referrer"></script>

	<!-- FontAwesome -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
		integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
		crossorigin="anonymous" referrerpolicy="no-referrer" />

	<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/js/all.min.js"
		integrity="sha512-uKQ39gEGiyUJl4AI6L+ekBdGKpGw4xJ55+xyJG7YFlJokPNYegn9KwQ3P8A7aFQAUtUsAQHep+d/lrGqrbPIDQ=="
		crossorigin="anonymous" referrerpolicy="no-referrer"></script>

	<script src="./data/water.geojson"></script>
	<script src="./data/aed.geojson"></script>
	<script src="./data/water2.geojson"></script>
	<script src="./data/toilet.geojson"></script>
	<script src="./data/warehouse.geojson"></script>

	<style>
		html,
		body,
		#map {
			width: 100%;
			height: 100%;
			padding: 0;
			margin: 0;
			z-index: 0;
		}

		body {
			font-family: "Meiryo", "Hiragino Maru Gothic Pro", sans-serif;
		}

		#map .link {
			color: #16a085 !important;
			border-bottom: 1px dotted #16a085;
		}

		#map .link:after {
			font-family: "Font Awesome 6 Free";
			content: ' \f35d';
			font-weight: 900;
		}

		.wrapper {
			display: grid;
			grid-template-columns: repeat(2, 1fr);
		}

		.leaflet-popup-content-wrapper {
			width: 280px;
		}

		#yes {
			color: #ff0000;
			font-size: 15px;
			font-weight: bold !important;
		}

		#no {
			font-size: 15px;
			font-weight: bold !important;
		}

		.solid_icon>i {
			position: absolute;
			top: -0.5em;
			left: -0.5em;
		}

		.color_lightblue {
			color: #2ca9e1;
		}

		.color_red {
			color: #e2041b;
		}

		.color_blue {
			color: #19448e;
		}

		.color_tblue {
			color: #f08300;
		}

		.color_house{
			color: #bb5548;
		}

		#cross {
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			z-index: 10;
		}
	</style>

	<script type="module">

		let map;

		onload = async () => {

			const map = L.map('map', {
				center: [35.199, 136.965,],
				zoomControl: false,
				zoom: 16
			});

			/* GPSボタン */
			let ido;
			let keido;
			let gps_get = (position) => {
				ido = position.coords.latitude;
				keido = position.coords.longitude;
				map.setView([ido, keido], 16);

			}

			let gps_error = (error) => {
				alert("エラーが発生したので、現在地を取得できませんでした。");
			}

			let GPS = () => {
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(gps_get, gps_error);
				} else {
					alert("エラーが発生したので、現在地を取得できませんでした。");
				}
			}

			let fpv = () => {
				location.href = "./fpv.html";
			}

			/* コントロールボタン */
			L.control.zoom({ position: 'topright' }).addTo(map);
			let gps_button = L.easyButton('fa-location-arrow', function () { GPS(); }, { position: 'topright' }).addTo(map);

			const hash = new L.Hash(map);

			let fpv_button = L.easyButton('fa-male', function () { fpv(); }, { position: 'topright' }).addTo(map);

			const tiles = L.tileLayer('https://tile.openstreetmap.jp/styles/maptiler-basic-ja/{z}/{x}/{y}.png', {
				maxZoom: 19,
				attribution: '&copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a><br>&copy; <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap contributors</a>'
			}).addTo(map);

			const shinsui = new L.tileLayer('https://disaportaldata.gsi.go.jp/raster/01_flood_l2_shinsuishin_kuni_data/{z}/{x}/{y}.png', {
				opacity: 0.8
			}).addTo(map);

			// 給水拠点
			let water_add = L.geoJSON(water, { onEachFeature: popup_water, pointToLayer: water_point });
			map.addLayer(water_add);

			// AED設置場所
			let aed_add = L.geoJSON(aed, { onEachFeature: popup_aed, pointToLayer: aed_point });
			map.addLayer(aed_add);

			// 給水柱
			let water2_add = L.geoJSON(water2, { onEachFeature: popup_water2, pointToLayer: water2_point });
			map.addLayer(water2_add);

			// 仮説トイレ
			let toilet_add = L.geoJSON(toilet, { onEachFeature: popup_toilet, pointToLayer: toilet_point });
			map.addLayer(toilet_add);

			// 防災倉庫
			let warehouse_add = L.geoJSON(warehouse, { onEachFeature: popup_warehouse, pointToLayer: warehouse_point });
			map.addLayer(warehouse_add);

		}

		/* 給水拠点 */
		let water_point = (feature, latlng) => {
			return L.marker(latlng, {
				icon: L.divIcon({
					/*Font Awesomeの埋め込みコード*/
					html: '<i class="fas fa-droplet fa-2x"></i>',
					className: 'color_lightblue solid_icon',
					iconSize: [0, 0]
				}),
			});
		}

		let popup_water = (feature, layer) => {
			let popup;
			if (feature.properties && feature.properties.name) {
				popup = "<h1 class='text-lg mb-3'>" + feature.properties.name + "</h1>" + feature.properties.address + "<br><br>容量：" + feature.properties.capacity + "立方メートル";

			} else { };

			layer.bindPopup(popup);
		}

		/* AED設置場所 */
		let aed_point = (feature, latlng) => {
			return L.marker(latlng, {
				icon: L.divIcon({
					/*Font Awesomeの埋め込みコード*/
					html: '<i class="fa-solid fa-heart-pulse fa-2x"></i>',
					className: 'color_red solid_icon',
					iconSize: [0, 0]
				}),
			});
		}

		let popup_aed = (feature, layer) => {
			let popup;
			if (feature.properties && feature.properties.name) {
				popup = "<h1 class='text-lg mb-3'>AED設置場所</h1>" + feature.properties.name + "<br>" + feature.properties.address + "<br>" + feature.properties.place;

			} else { };

			layer.bindPopup(popup);
		}

		/* 給水栓 */
		let water2_point = (feature, latlng) => {
			return L.marker(latlng, {
				icon: L.divIcon({
					/*Font Awesomeの埋め込みコード*/
					html: '<i class="fa-solid fa-fire-extinguisher fa-2x"></i>',
					className: 'color_blue solid_icon',
					iconSize: [0, 0]
				}),
			});
		}

		let popup_water2 = (feature, layer) => {
			let popup;
			if (feature.properties && feature.properties.name) {
				popup = "<h1 class='text-lg mb-3'>地下式給水栓</h1>" + feature.properties.name + "<br>" + feature.properties.address + "<br>" + feature.properties.place;

			} else { };

			layer.bindPopup(popup);
		}

		/* 仮説トイレ */
		let toilet_point = (feature, latlng) => {
			return L.marker(latlng, {
				icon: L.divIcon({
					/*Font Awesomeの埋め込みコード*/
					html: '<i class="fa-solid fa-toilet fa-2x"></i>',
					className: 'color_tblue solid_icon',
					iconSize: [0, 0]
				}),
			});
		}

		let popup_toilet = (feature, layer) => {
			let popup;
			if (feature.properties && feature.properties.name) {
				popup = "<h1 class='text-lg mb-3'>下水道直結式仮設トイレ</h1>" + feature.properties.name + "<br>" + feature.properties.address + "<br>" + feature.properties.place;

			} else { };

			layer.bindPopup(popup);
		}

		/* 防災倉庫 */
		let warehouse_point = (feature, latlng) => {
			return L.marker(latlng, {
				icon: L.divIcon({
					/*Font Awesomeの埋め込みコード*/
					html: '<i class="fa-solid fa-home fa-2x"></i>',
					className: 'color_house solid_icon',
					iconSize: [0, 0]
				}),
			});
		}

		let popup_warehouse = (feature, layer) => {
			let popup;
			if (feature.properties && feature.properties.name) {
				popup = "<h1 class='text-lg mb-3'>防災倉庫</h1>" + feature.properties.name + "<br>" + feature.properties.address + "<br>" + feature.properties.place;

			} else { };

			layer.bindPopup(popup);
		}

	</script>

</head>

<body>

	<!-- cross_key -->
	<div id="cross">
		<img id="img_cross" src="./images/cross.gif">
	</div>

	<div id='map'></div>

</body>

</html>